# Makefile for CVE-2019-2215
#
# NDK_ROOT=/home/ashfaq/Android/Sdk/ndk/21.0.6113669 make
#

CXXFLAGS        := -static -O3 -Wall -Wextra -g 

#CROSS_COMPILE   := $(HOME)/Android/Sdk/ndk/25.1.8937393/toolchains/llvm/prebuilt/linux-x86_64/bin
CROSS_COMPILE   := $(HOME)/Downloads/android-ndk-r22b/toolchains/llvm/prebuilt/linux-x86_64/bin
TARGET_PLATFORM := $(ARCH)-linux-android
CXX_PATH        := $(CROSS_COMPILE)/aarch64-linux-android30-clang++

TRIGGER_SRC     := poc.c
TRIGGER_OUTPUT  := poc 

# default rule
default: all

# phony rules
.PHONY: all

all: clean build-trigger push-trigger

build-trigger:
	@echo Building: $(TRIGGER_OUTPUT)
	@$(CXX_PATH) $(CXXFLAGS) -o $(TRIGGER_OUTPUT) $(TRIGGER_SRC)

clean:
	@echo Removing: $(TRIGGER_OUTPUT)
	@rm -f $(TRIGGER_OUTPUT)

push-trigger:
	@echo Pushing: $(TRIGGER_OUTPUT) to /data/local/tmp
	@adb push $(TRIGGER_OUTPUT) /data/local/tmp

